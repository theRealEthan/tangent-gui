<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Details</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        /* Custom Styles */
        /*... Your styles ...*/

        table {
            width: 100%;
            margin-top: 20px;
        }

        th, td {
            text-align: center;
        }
    </style>
</head>
<body>
<h1>Employees</h1>
<h2 id="employee_count">There are ... employees</h2>
<br>
<input type="text" placeholder="Search" class="form-control">
<br>
<select name="filter" class="form-control">
    <option value="last_name">Last Name</option>
    <option value="contact_number">Contact Number</option>
    <option value="first_name">First Name</option>
</select>
<br>

<button type="button" class="btn btn-primary" id="create_employee_button">Create New Employee</button>
<table id="employee_table" class="table table-bordered table-hover">
    <tr>
        <th>First Name</th>
        <th>Last Name</th>
        <th>Contact Number</th>
        <th>View</th>
    </tr>
</table>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    jQuery.noConflict();
    (function($) {


        $(document).ready(function() {

            $("#create_employee_button").click(function() {
                // Redirect to the page for creating a new employee
                window.location.href = 'http://localhost:8081/employee/create';
            });

            $.ajax({
                url: 'http://localhost:8080/employee/all',
                type: 'GET',
                success: function(response) {
                    if (response.length === 0) {
                        // No employees found
                        $('#employee_count').text('No Employees found');
                    } else
                    {
                        var employee_data = '';
                        var table_heading = '<tr>'+
                            '<th>First Name</th>'+
                            '<th>Last Name</th>'+
                            '<th>Contact Number</th>'+
                            '<th>View</th>'+
                            '</tr>';
                        var isFirstRow = true;
                        $.each(response, function(key, value){
                            if (isFirstRow) {
                                employee_data += table_heading;
                                isFirstRow = false;
                            }

                            var employee_id = value.employee_id;

                            employee_data += '<tr>'+
                                '<td>'+value.first_name+'</td>'+
                                '<td>'+value.last_name+'</td>'+
                                '<td>'+value.contact_number+'</td>'+
                                '<td><button type="button" class="btn btn-primary" onclick="viewEmployee(\''+employee_id+'\')">View</button></td>'+
                                '</tr>';
                        });
                        $('#employee_table').html(employee_data);
                        $("#employee_count").text("There are " + response.length + " employees");
                    }
                },
                error: function(error) {
                    // An error occurred
                    $('#employee_count').text('An Error Occurred');
                }
            });

            function viewEmployee(employeeId) {
                window.location.href = 'http://localhost:8081/employee/view/'+employeeId;
            }

            // Add the view button to the DOM
            var viewButton = '<button type="button" class="btn btn-primary" onclick="viewEmployee(employeeId)">View</button>';
            $('#employee_table tr').append(viewButton);

            // Set the onclick event handler of the button
            viewButton.onclick = function(employeeId) {
                viewEmployee(employeeId);
            };

        });


    })(jQuery);

    function viewEmployee(employeeId) {
        window.location.href = 'http://localhost:8081/employee/view/'+employeeId;
    }

</script>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
