<!DOCTYPE html>
<html>
<head>
    <title>Form Example</title>
</head>
<body>
<div class="container">
    <form id="user-form">
        <div class="form-group">
            <label for="first_name">First Name:</label>
            <input type="text" class="form-control" id="first_name" required>
        </div>
        <div class="form-group">
            <label for="last_name">Last Name:</label>
            <input type="text" class="form-control" id="last_name" required>
        </div>
        <div class="form-group">
            <label for="contact_number">Contact Number:</label>
            <input type="text" class="form-control" id="contact_number" required>
        </div>
        <div class="form-group">
            <label for="date_of_birth">Date of Birth:</label>
            <input type="date" class="form-control" id="date_of_birth" required>
        </div>
        <div class="form-group">
            <label for="street_address">Street Address:</label>
            <input type="text" class="form-control" id="street_address" required>
        </div>
        <div class="form-group">
            <label for="city">City:</label>
            <input type="text" class="form-control" id="city" required>
        </div>
        <div class="form-group">
            <label for="country">Country:</label>
            <input type="text" class="form-control" id="country" required>
        </div>
        <div class="form-group">
            <label for="postal_code">Postal Code:</label>
            <input type="text" class="form-control" id="postal_code" required>
        </div>

        <div id="skill-area">
            <h3>Skills</h3>
        </div>

        <button type="button" class="btn btn-primary" id="add-skill">Add Skill</button>
        <button type="submit" class="btn btn-success">Submit</button>
    </form>
</div>

<script>

    var seniorityRatings = [];

    // Fetch seniority ratings
    function fetchSeniorityRatings() {
        $.ajax({
            type: 'GET',
            url: 'http://localhost:8080/ratings/all',
            success: function(response) {
                seniorityRatings = response;
            },
            error: function(error) {
                console.error(error);
                alert('Error fetching seniority ratings');
            }
        });
    }

    $(document).ready(function() {

        fetchSeniorityRatings();

        $('#add-skill').click(function() {
            var seniorityOptionsHtml = seniorityRatings.map(function(rating) {
                return '<option value="' + rating.id + '">' + rating.rating + '</option>';
            }).join('');

            $('#skill-area').append(
                '<div class="skill-group row">'+
                '<div class="form-group col-md-4">'+
                '<label for="skill_name">Skill Name:</label>'+
                '<input type="text" class="form-control skill_name" required>'+
                '</div>'+
                '<div class="form-group col-md-4">'+
                '<label for="years_experience">Years Experience:</label>'+
                '<input type="number" class="form-control years_experience" required>'+
                '</div>'+
                '<div class="form-group col-md-4">'+
                '<label for="seniority_rating_id">Seniority Rating:</label>'+
                '<select class="form-control seniority_rating_id" required>'+
                seniorityOptionsHtml+
                '</select>'+
                '</div>'+
                '</div>'
            );
        });

        $('#user-form').submit(function(e) {
            e.preventDefault();

            // Prepare data
            var data = {
                first_name: $('#first_name').val(),
                last_name: $('#last_name').val(),
                contact_number: $('#contact_number').val(),
                date_of_birth: $('#date_of_birth').val(),
                street_address: $('#street_address').val(),
                city: $('#city').val(),
                country: $('#country').val(),
                postal_code: $('#postal_code').val(),
                skills: []
            };

            $('#skill-area .skill-group').each(function(i, skillGroup) {
                var skill = {
                    skill_name: $(skillGroup).find('.skill_name').val(),
                    years_experience: $(skillGroup).find('.years_experience').val(),
                    seniority_rating_id: $(skillGroup).find('.seniority_rating_id').val()
                };
                data.skills.push(skill);
            });

            // POST request
            $.ajax({
                type: 'POST',
                url: 'http://localhost:8080/employee/create',
                data: JSON.stringify(data),
                contentType: 'application/json',
                success: function(response) {
                    alert('Data posted successfully');
                },
                error: function(error) {
                    console.error(error);
                    alert('Error posting data');
                }
            });
        });
    });
</script>
</body>
</html>
